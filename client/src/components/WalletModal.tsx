import { useRef, useEffect } from "react";
import { useWallet } from "../lib/wallets.tsx";

export default function WalletModal() {
  const { showModal, setShowModal, connectMetaMask, connectPhantom, connectBrave } = useWallet();
  const modalRef = useRef<HTMLDivElement>(null);

  // Close the modal when clicking outside
  useEffect(() => {
    function handleClickOutside(event: MouseEvent) {
      if (modalRef.current && !modalRef.current.contains(event.target as Node)) {
        setShowModal(false);
      }
    }

    if (showModal) {
      document.addEventListener("mousedown", handleClickOutside);
    }
    
    return () => {
      document.removeEventListener("mousedown", handleClickOutside);
    };
  }, [showModal, setShowModal]);

  if (!showModal) return null;

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center">
      <div className="absolute inset-0 bg-black bg-opacity-70 backdrop-blur-sm"></div>
      <div 
        ref={modalRef}
        className="glass relative z-10 p-6 rounded-2xl border border-slate-700 max-w-md w-full mx-4 shadow-2xl"
      >
        <div className="flex justify-between items-center mb-6">
          <h2 className="text-xl font-bold text-white">Connect Your Wallet</h2>
          <button 
            onClick={() => setShowModal(false)}
            className="text-slate-400 hover:text-white"
          >
            <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>
        
        <div className="space-y-4">
          <button 
            className="w-full bg-[#F6851B]/10 hover:bg-[#F6851B]/20 text-white font-medium py-3 px-4 rounded-xl border border-[#F6851B]/30 flex items-center justify-between transition duration-200"
            onClick={connectMetaMask}
          >
            <div className="flex items-center">
              <div className="h-8 w-8 mr-3 bg-[#F6851B] rounded-full flex items-center justify-center">
                <svg viewBox="0 0 33 31" fill="none" xmlns="http://www.w3.org/2000/svg" className="h-6 w-6">
                  <path d="M30.8958 1L18.85 10.2L21.1583 4.91583L30.8958 1Z" fill="white" stroke="white" strokeWidth="0.25" strokeLinecap="round" strokeLinejoin="round" />
                  <path d="M2.10413 1L14.0541 10.2833L11.8416 4.91583L2.10413 1Z" fill="white" stroke="white" strokeWidth="0.25" strokeLinecap="round" strokeLinejoin="round" />
                  <path d="M26.5042 22.1417L23.2333 27.1167L30.1792 29.0583L32.1458 22.2583L26.5042 22.1417Z" fill="white" stroke="white" strokeWidth="0.25" strokeLinecap="round" strokeLinejoin="round" />
                  <path d="M0.870728 22.2583L2.82073 29.0583L9.76656 27.1167L6.49573 22.1417L0.870728 22.2583Z" fill="white" stroke="white" strokeWidth="0.25" strokeLinecap="round" strokeLinejoin="round" />
                  <path d="M9.39993 13.7083L7.41245 16.6167L14.2916 16.9083L14.0499 9.45831L9.39993 13.7083Z" fill="white" stroke="white" strokeWidth="0.25" strokeLinecap="round" strokeLinejoin="round" />
                  <path d="M23.5999 13.7083L18.8666 9.37498L18.8499 16.9083L25.7291 16.6167L23.5999 13.7083Z" fill="white" stroke="white" strokeWidth="0.25" strokeLinecap="round" strokeLinejoin="round" />
                  <path d="M9.76656 27.1167L13.8708 25.075L10.2708 22.3167L9.76656 27.1167Z" fill="white" stroke="white" strokeWidth="0.25" strokeLinecap="round" strokeLinejoin="round" />
                  <path d="M19.1292 25.075L23.2334 27.1167L22.7125 22.3167L19.1292 25.075Z" fill="white" stroke="white" strokeWidth="0.25" strokeLinecap="round" strokeLinejoin="round" />
                </svg>
              </div>
              <span className="text-lg">MetaMask</span>
            </div>
            <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 text-[#F6851B]" viewBox="0 0 20 20" fill="currentColor">
              <path fillRule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clipRule="evenodd" />
            </svg>
          </button>
          
          <button 
            className="w-full bg-[#AB9FF2]/10 hover:bg-[#AB9FF2]/20 text-white font-medium py-3 px-4 rounded-xl border border-[#AB9FF2]/30 flex items-center justify-between transition duration-200"
            onClick={connectPhantom}
          >
            <div className="flex items-center">
              <div className="h-8 w-8 mr-3 bg-[#AB9FF2] rounded-full flex items-center justify-center">
                <svg width="32" height="32" viewBox="0 0 128 128" fill="none" xmlns="http://www.w3.org/2000/svg" className="h-7 w-7">
                  <path d="M109.9,30.31c-5.24-12.56-45.23-30-78.5-1C9.93,49.31,17,72.51,22.45,81.46a20.29,20.29,0,0,0,0,3.92c0,13.06,10.83,23.67,23.92,23.67a24,24,0,0,0,24-24V66.12L88.91,84.58a2.48,2.48,0,0,0,3.33,0A2.35,2.35,0,0,0,93,83.1a2.3,2.3,0,0,0,.32-1.17V51.49l11.12,10.88a2.47,2.47,0,0,0,3.4,0,2.35,2.35,0,0,0,.28-3.05,2.47,2.47,0,0,0-.28-.28L95.09,46.42a2.45,2.45,0,0,0-3.32,0l-12.7,12.47V16.32A2.45,2.45,0,0,0,76.66,14h-.06a2.44,2.44,0,0,0-2.44,2.35v42.5L61.85,46.4a2.47,2.47,0,0,0-3.33,0L44.75,59.07a2.42,2.42,0,0,0,0,3.33,2.47,2.47,0,0,0,3.33,0l11-10.79V81.93a12.11,12.11,0,0,1-12.08,11.72A12.23,12.23,0,0,1,34.88,81.5a13.25,13.25,0,0,1,.81-4.21,2.4,2.4,0,0,0-1.24-3.14,2.57,2.57,0,0,0-3.09,1A2.32,2.32,0,0,0,31,76c-.07.19-.19.42-.26.61-5.6-9-12.1-30.91,6.87-48.27,25.67-23.4,58.23-11.13,65.14-1a2.45,2.45,0,0,0,3.06,1.57,2.39,2.39,0,0,0,1.65-3Z" fill="white" />
                </svg>
              </div>
              <span className="text-lg">Phantom</span>
            </div>
            <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 text-[#AB9FF2]" viewBox="0 0 20 20" fill="currentColor">
              <path fillRule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clipRule="evenodd" />
            </svg>
          </button>
          
          <button 
            className="w-full bg-[#FF5341]/10 hover:bg-[#FF5341]/20 text-white font-medium py-3 px-4 rounded-xl border border-[#FF5341]/30 flex items-center justify-between transition duration-200"
            onClick={connectBrave}
          >
            <div className="flex items-center">
              <div className="h-8 w-8 mr-3 bg-[#FF5341] rounded-full flex items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" className="h-6 w-6">
                  <path d="M23.3533 6.02222C22.3133 4.96 21.1378 3.92889 19.8489 3.01333C19.1822 2.52444 18.4044 2.15111 17.5911 1.83111C17.1556 1.656 16.6667 1.53778 16.12 1.39556C15.7022 1.30667 15.2489 1.25333 14.7956 1.24444C14.3067 1.23556 14.0178 1.68889 14.3778 2.04444C14.6489 2.31111 14.9644 2.53333 15.2978 2.73778C15.4489 2.81778 15.64 2.94222 15.8133 3.04889C16.0222 3.17333 16.2222 3.30667 16.4133 3.44889C16.7911 3.73333 17.1422 4.06222 17.4756 4.40889C17.8 4.74667 18.1067 5.10222 18.3956 5.46667C18.6933 5.84 18.9822 6.23111 19.2356 6.64C19.4978 7.05778 19.7333 7.48444 19.9333 7.93778C19.9778 8.05333 20.0311 8.29333 20.0756 8.43556C20.1467 8.65778 20.1911 8.88889 20.2267 9.12C20.28 9.48444 20.3067 9.85778 20.2889 10.24C20.28 10.6222 20.2178 11.0044 20.1467 11.3778C20.0578 11.7867 19.9333 12.1867 19.7778 12.5778C19.6222 12.9689 19.4267 13.3511 19.2178 13.7156C18.8 14.4623 18.2844 15.1645 17.6978 15.8045C17.3511 16.16 16.9867 16.5067 16.6044 16.8267C16.2222 17.1556 15.8222 17.4534 15.4133 17.7111C15.0044 17.9778 14.5778 18.2045 14.1422 18.4178C13.7067 18.6223 13.2622 18.8089 12.8 18.9556C12.1156 19.1734 11.4133 19.3378 10.6933 19.4534C9.98222 19.5689 9.25333 19.6223 8.51556 19.6223C8.42667 19.6223 8.24889 19.6134 8.16889 19.6134C7.96445 19.6045 7.76 19.5778 7.55556 19.5512C7.15556 19.4978 6.76444 19.4178 6.37333 19.3112C5.99111 19.2134 5.61778 19.0845 5.24444 18.9512C4.88 18.8178 4.52444 18.6578 4.17778 18.4889C3.82222 18.32 3.48444 18.1156 3.15556 17.9023C2.48889 17.4845 1.82222 16.9512 1.35111 16.3112C1.04889 15.8934 0.817778 15.4134 0.656 14.9156C0.497778 14.4089 0.4 13.8578 0.382222 13.3067C0.373333 13.0356 0.382222 12.7556 0.417778 12.4845C0.453333 12.2045 0.508 11.9334 0.577778 11.6623C0.711111 11.12 0.911111 10.6045 1.16 10.1245C1.41778 9.63556 1.73778 9.18222 2.08444 8.76444C2.44 8.34667 2.84 7.96444 3.26667 7.62667C3.69333 7.28889 4.14667 6.99556 4.62667 6.74667C5.58222 6.27556 6.62222 6.00889 7.68 5.95556C8.22667 5.92889 8.77333 5.96444 9.32 6.04444C9.85778 6.12444 10.3911 6.25778 10.92 6.44444C11.4578 6.63111 11.9822 6.87111 12.4889 7.16444C13.0044 7.46667 13.4933 7.82222 13.9378 8.24L14.1289 8.44444L14.32 8.64889L14.7022 9.06667L15.4667 9.89333C15.7467 10.1911 16.1644 10.6045 16.5911 10.56C16.9289 10.5245 17.2667 10.32 17.5556 10.1156C17.8444 9.92 18.0978 9.67111 18.2889 9.36889C18.6844 8.76444 18.8889 8.04444 18.9156 7.32444C18.92 7.15556 18.9067 6.98667 18.8889 6.81778C18.8711 6.64889 18.8356 6.48 18.7911 6.32C18.7111 5.98222 18.5911 5.65333 18.4356 5.34222C18.28 5.03111 18.0889 4.74667 17.88 4.49778C17.48 4.01778 17.0133 3.59111 16.4933 3.23556C15.9644 2.88 15.4 2.58667 14.8178 2.36444C14.2267 2.14222 13.6178 1.99111 13 1.91111C12.3733 1.83111 11.7467 1.82222 11.12 1.896C10.1333 2.01333 9.18667 2.32444 8.31111 2.78667C7.44444 3.24889 6.65778 3.84444 5.98222 4.55556C5.64444 4.90222 5.33333 5.28444 5.04889 5.67556C4.76444 6.06667 4.51556 6.48444 4.31111 6.91111C3.9 7.76889 3.62667 8.68444 3.51111 9.61778C3.45778 10.0889 3.44 10.56 3.46667 11.0311C3.49333 11.5023 3.56444 11.9734 3.68889 12.4267C3.69778 12.4445 3.70667 12.4712 3.71556 12.4889C3.73333 12.5512 3.75111 12.6134 3.77778 12.6756C3.86667 12.8889 3.97333 13.0934 4.09778 13.2978C4.33778 13.7067 4.62222 14.0978 4.95111 14.4534C5.28889 14.8178 5.67111 15.1467 6.08889 15.4267C6.91556 15.9867 7.85333 16.4267 8.84 16.7512C9.82667 17.0667 10.86 17.2489 11.92 17.3112C12.9867 17.3734 14.0533 17.2934 15.1111 17.0845C16.1689 16.8845 17.2089 16.5556 18.2044 16.1378C18.7156 15.9378 19.2089 15.7067 19.6889 15.4534C20.1689 15.2089 20.6311 14.9245 21.0756 14.6245C21.52 14.3245 21.9467 13.9956 22.3556 13.6578C22.7644 13.32 23.1467 12.9511 23.5111 12.5689C24.24 11.8 24.9067 10.9512 25.4667 10.04C25.7467 9.58222 26 9.10222 26.2267 8.61333C26.4533 8.12444 26.6533 7.62667 26.8089 7.12C26.9644 6.61333 27.0844 6.09778 27.16 5.58222C27.2356 5.05778 27.2667 4.53333 27.2533 4.00889C27.2444 3.74222 27.2267 3.47556 27.1911 3.20889C27.1556 2.94222 27.1022 2.68444 27.0489 2.42667C26.9422 1.91111 26.7867 1.40444 26.6 0.916C26.5644 0.828 26.5022 0.631111 26.4844 0.668C26.4578 0.711111 26.4489 0.808889 26.4844 0.978667C26.5111 1.11111 26.5556 1.25333 26.6089 1.38667C26.7156 1.65333 26.8444 1.92 26.9644 2.176C27.0844 2.44444 27.2 2.71111 27.3067 2.98667C27.4133 3.26222 27.5111 3.54667 27.6 3.83111C27.6889 4.11556 27.7689 4.40889 27.84 4.70222C27.9822 5.29778 28.0978 5.90222 28.1689 6.51556C28.24 7.12889 28.2844 7.74222 28.2844 8.36444C28.2933 9.00444 28.2667 9.65333 28.2044 10.2934C28.1422 10.9334 28.0444 11.5734 27.9111 12.2045C27.7778 12.8356 27.6267 13.4578 27.4311 14.0711C27.2356 14.6845 27.0133 15.2889 26.7644 15.8756C26.5156 16.4711 26.24 17.0489 25.9422 17.6178C25.6444 18.1867 25.3244 18.7378 24.98 19.2711C24.6356 19.8045 24.28 20.3111 23.8889 20.8C23.5067 21.2889 23.1111 21.7689 22.6978 22.2223L21.1556 23.7645H22.6978L22.8356 23.9111L22.9733 24.0489C23.1822 24.2578 23.4 24.4667 23.6178 24.6667C23.8356 24.8756 24.0622 25.0756 24.2889 25.2756C24.7422 25.6756 25.2089 26.0667 25.6845 26.4489C26.16 26.8222 26.6445 27.1867 27.1289 27.5511L27.8578 28.0845L28.5867 28.6267L29.9867 29.7023L31.3867 30.7867L30.8489 31.2667H29.3956C29.0756 31.2667 28.7556 31.2667 28.4356 31.2667C28.1156 31.2667 27.8044 31.2578 27.4933 31.24L26.56 31.2133L25.6267 31.1778L23.76 31.1067H18.12H17.4844L17.16 31.3556C16.7244 31.6889 16.2533 31.96 15.76 32.1689C15.5067 32.2845 15.2356 32.3734 14.9644 32.4445C14.6933 32.5156 14.4133 32.5689 14.1333 32.6045C13.5644 32.6756 12.9956 32.6756 12.4356 32.6489C11.8756 32.6223 11.3244 32.5334 10.7911 32.4178C10.52 32.36 10.2578 32.2845 10.0044 32.1867C9.75111 32.0889 9.50222 31.9823 9.26222 31.8667C8.77333 31.6356 8.31111 31.3467 7.88444 31.0223C7.74222 30.9156 7.60889 30.7956 7.47556 30.6756C7.34222 30.5556 7.20889 30.4356 7.08444 30.3067L6.71111 29.9245L6.33778 29.5512L5.60889 28.8045C5.19111 28.3867 4.78222 27.96 4.37333 27.5245C3.96445 27.0889 3.56445 26.6445 3.16445 26.1912C2.76445 25.7378 2.36444 25.2756 1.97333 24.8045C1.77778 24.5689 1.58222 24.3334 1.39556 24.0889C1.2 23.8534 1.01333 23.6089 0.835556 23.3645C0.656 23.12 0.488889 22.8667 0.32 22.6134C0.16 22.36 0 22.0978 0 21.9111V21.6134C0 21.4889 0.124445 21.3645 0.16 21.3378C0.2 21.3112 0.257778 21.3112 0.32 21.2845C0.382222 21.2667 0.453333 21.2489 0.524444 21.2311L0.666667 21.1956L0.8 21.16C1.13778 21.0711 1.48444 20.9912 1.82222 20.9023C2.17778 20.8134 2.53333 20.7423 2.88889 20.6534C3.6 20.4889 4.32 20.3423 5.04889 20.1956C5.76889 20.0489 6.48889 19.9111 7.21778 19.7734C7.94667 19.6356 8.68444 19.5156 9.42222 19.3867C10.16 19.2578 10.9067 19.1378 11.6533 19.0267C11.7867 19 11.9289 18.9823 12.0622 18.9556C12.1956 18.9289 12.3378 18.9111 12.4711 18.8845C12.7378 18.8312 13.0044 18.7778 13.2711 18.7334C13.5467 18.6889 13.8133 18.64 14.08 18.6045C14.6222 18.5334 15.1556 18.4712 15.6889 18.4267C16.2222 18.3823 16.7556 18.3378 17.2889 18.3112C18.3556 18.2489 19.4222 18.2223 20.4889 18.24C21.0222 18.2489 21.5556 18.2756 22.0889 18.32C22.3556 18.3378 22.6222 18.36 22.8889 18.3911C23.1467 18.4223 23.4133 18.4623 23.6889 18.4889C24.24 18.5512 24.7911 18.6312 25.3333 18.7245C25.3333 18.7245 25.2889 18.7245 25.3067 18.7334C25.3244 18.7334 25.3422 18.7334 25.36 18.7423L24.0356 17.9689L23.6444 17.7245L24.0356 17.3334L24.2356 17.1334C24.5778 16.8 24.9111 16.4489 25.2356 16.0934C25.5511 15.7378 25.8667 15.3734 26.1644 14.9912C26.4622 14.6089 26.7511 14.2178 27.0222 13.8178C27.2933 13.4178 27.5556 13.0089 27.8 12.5912C28.0444 12.1734 28.2711 11.7467 28.48 11.3111C28.6889 10.8756 28.88 10.4312 29.0533 9.97778C29.2267 9.52444 29.3733 9.06222 29.5111 8.59111C29.6489 8.12 29.7511 7.64 29.8444 7.15111C29.9378 6.66222 30 6.16444 30.0444 5.66667C30.0711 5.41778 30.0889 5.16889 30.0978 4.92C30.1067 4.67111 30.1067 4.42222 30.0978 4.16444C30.0889 3.66667 30.0533 3.15111 30 2.64444C29.9467 2.13778 29.8711 1.63111 29.7778 1.12444C29.7422 0.968889 29.7067 0.804444 29.6622 0.64C29.6178 0.475556 29.5733 0.311111 29.5289 0.146667C29.5289 0.146667 29.5289 0.146667 29.5289 0.146667C29.5467 0.413333 29.3556 0.773333 29.2622 1.03111C29.12 1.43111 28.9156 1.82222 28.6889 2.19556C28.4533 2.56 28.2089 2.92444 27.9289 3.26222C27.6489 3.6 27.3689 3.92889 27.0622 4.23111C26.7556 4.54222 26.4356 4.82667 26.1067 5.10222C25.7778 5.37778 25.4311 5.63556 25.0844 5.87556C24.7378 6.11556 24.3644 6.33778 24 6.53333C23.8089 6.64 23.6089 6.72889 23.4178 6.81778C23.3911 6.82667 23.3733 6.83556 23.3533 6.84444L23.3533 6.02222Z" fill="white"/>
                </svg>
              </div>
              <span className="text-lg">Brave Wallet</span>
            </div>
            <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 text-[#FF5341]" viewBox="0 0 20 20" fill="currentColor">
              <path fillRule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clipRule="evenodd" />
            </svg>
          </button>
        </div>
        
        <div className="mt-6 text-center text-sm text-slate-400">
          By connecting, you agree to NebulaCDN's{' '}
          <a href="#" className="text-primary hover:text-primary-light">Terms of Service</a>{' '}
          and{' '}
          <a href="#" className="text-primary hover:text-primary-light">Privacy Policy</a>
        </div>
      </div>
    </div>
  );
}
